<ul>#{list items: _iterator, as:'event'}
<!--  TODO: handle timezone correctly -->
%{
	eventOwner = event.calendar.owner.name
	visibility = "private"
	
	if (event.getVisibility().equals(ch.unibe.ese.calendar.Visibility.PUBLIC)) { 
		visibility = "public"
	}
	if (event.getVisibility().equals(ch.unibe.ese.calendar.Visibility.BUSY)) {
		visibility = "show as busy"
	}
	if (event.getVisibility().equals(ch.unibe.ese.calendar.Visibility.CONTACTSONLY) 
		&& (_user.name == eventOwner)) {
		visibility = "contacts only"
	} else {
		visibility = "public"
	}		
		
	rep = "Event"
	if (event.getSeries() != null)
		rep = "SerialEvent"
}% 
<li>
#{if (event.getVisibility().equals(ch.unibe.ese.calendar.Visibility.BUSY) && (_user.name != eventOwner))}
	${eventOwner} is busy from ${event.start.format("HH:mm")} - ${event.end.format("HH:mm")}
#{/if}
#{else}
	#{if (event.getVisibility().equals(ch.unibe.ese.calendar.Visibility.CONTACTSONLY) && (_user.name != eventOwner))}
		#{if !event.calendar.owner.myContacts.containsKey(_user)}
			none
		#{/if}
		#{else}
			${event.name}<br/>
			${event.start.format("HH:mm"+", "+"dd.MMM")} - ${event.end.format("HH:mm"+", "+"dd.MMM")}<br/>
			(${visibility} ${rep} created by ${eventOwner})<br/>
			Description: ${event.description}
			#{if _user.name == eventOwner}
				<br/>
				<a href=@{ModifyEvent.editEvent(_calendar.name, event.getId(), 
					event.start.format("dd.MM.yyyy HH:mm"), event.getSeries() != null)}>Edit</a> | 
				<a href=@{ModifyEvent.deleteEvent(_calendar.name, event.getId(), 
					event.start.format("dd.MM.yyyy HH:mm"), event.getSeries() != null)}>Delete</a>
			#{/if}
		#{/else}
	#{/if}
	#{else}
		${event.name}<br/>
		${event.start.format("HH:mm"+", "+"dd.MMM")} - ${event.end.format("HH:mm"+", "+"dd.MMM")}<br/>
		(${visibility} ${rep} created by ${eventOwner})<br/>
		Description: ${event.description}
		#{if _user.name == eventOwner}
			<br/>
			<a href=@{ModifyEvent.editEvent(_calendar.name, event.getId(), 
				event.start.format("dd.MM.yyyy HH:mm"), event.getSeries() != null)}>Edit</a> | 
			<a href=@{ModifyEvent.deleteEvent(_calendar.name, event.getId(), 
				event.start.format("dd.MM.yyyy HH:mm"), event.getSeries() != null)}>Delete</a>
		#{/if}
	#{/else}
#{/else}
</li>
#{/list}
#{else} none #{/else}
</ul>